<!-- 
  Refactored by Keaton
  May 12th, 2017
  schools/index.html.erb
  A view which displays the schools/locations and allows the user to create a new school/location
-->

<!-- Render premade navigation bar -->
<%= render "shared/nav", title: "Schools", bar_class: "def", link: "/admin" %>

<!-- Displays a table of schools/locations -->
<div class="inner-wrapper">
  <table align="center" class="school-form">
    <tr>
      <th>Name</th>
      <th>Role</th>
      <th>Status</th>
      <th>Actions</th>
      <th></th>
    </tr>
    <% if School.all.each.count > 0 %>
      <% School.all.each do |school| %>
        <tr>
          <td><%= school.name %></td>
          <% school.role_quantities.each do |role_quantity| %>
            <td><%= "#{role_quantity.get_role.name}: #{role_quantity.quantity}/#{role_quantity.max_quantity}" %></td>
            <td><%= ready_for_deployment(role_quantity) %></td>
          <% end %>
          <td>
            <%= link_to raw('<i class="ic close red-icon"></i>'), school, method: :delete, data: {confirm: "Are you sure you want to delete #{school[:name]}?"} %>
            <%= link_to raw('<i class="ic edit"></i>'), school, method: :edit %>
            <%= link_to raw('<i class="ic view"></i>'), {:controller => "schools", :action => "view", :id => school[:id]} %>
          </td>
          <td>
            <a href="#">Deployment Sheet</a>
          </td>
        </tr>
      <% end %>
    <% end %>
  </table>
</div>

<div class="inner-wrapper" id="second-wrapper">
  <!-- Displays a form for new form creation -->
  <%= form_for(@school, url: {action: "create"}, method: :post) do |f| %>
    <table align="center" class="school-form-table">
      <tr class="flex-form-title">
        <td class="section-title">New School:</td>
      </tr>
      <tr class="flex-section-title">
        <td class="section-title">Essential Info:</td>
      </tr>
      <tr class="flex-form">
        <td class="school-form">
          <%= f.label :name_label, 'Name', :class => "label name" %>
          <%= f.text_field :name, :class => "name text-input", :placeholder => "White Station" %>
        </td>
      </tr>
      <tr class="flex-form">
        <td class="school-form">
          <%= f.label :school_code_label, 'School Code', :class => "label school-code" %>
          <%= f.text_field :school_code, :class => "school-code text-input", :placeholder => "1738-A" %>
        </td>
      </tr>
      <% Role.all.each_with_index do |role, index| %>
        <tr class="flex-section-title">
          <td class="section-title"><%= role.name.titleize %> Role:</td>
        </tr>
        <tr class="flex-form" id="role-max-quantity">
          <td class="school-form">
            <%= f.label nil, "Max Quantity:", :class => "label role-schools" %>
            <input type="number" class="school-role text-input" placeholder="200" name="roles[<%= index %>][quantity]">
          </td>
        </tr>
        <tr class="flex-form" id="ou-string">
          <td class="school-form">
            <%= f.label nil, "OU", :class => "label ou-schools" %>
            <input class="school-role text-input" placeholder="OU=Windfield" name="roles[<%= index %>][ou]">
          </td>
        </tr>
        <%= hidden_field_tag "roles[#{index}][id]", role.id %>
      <% end %>
      <tr class="flex-form">
        <td class="school-form">
          <%= f.label :blended_learning_label, 'Blended Learning', :class => "label blended-learning" %>
          <div class="switch">
            <%= f.check_box :blended_learning, :class => "cmn-toggle cmn-toggle-round blended_learning", :id => "cmn-toggle-1" %>
            <label class="switch-label" for="cmn-toggle-1"></label>
          </div>
        </td>
      </tr>
      <tr class="flex-form">
        <td class="school-form">
          <%= f.submit 'Submit', :class => 'button submit small button-table' %>
        </td>
      </tr>
    </table>
  <% end %>
</div>
